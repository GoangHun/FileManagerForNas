# 개발일지: 2025-11-11

## 완료된 작업

### 1. React 핵심 개념 질의응답 및 문서화
- 사용자의 질문에 답변하며 React의 주요 개념에 대해 설명함.
  - `useState` Hook의 역할과 사용법
  - React Hooks와 Unity 이벤트 함수의 유사점 및 차이점
  - `useEffect` Hook의 동작 방식과 비동기 처리 패턴
  - `Promise`와 `yield` (Generator)의 관계
- 위 논의 내용을 `doc/react_component_concepts.md` 파일에 상세히 기록하여 문서화함.

### 2. 프론트엔드 아키텍처 리팩토링
- 기존에 `App.tsx`에 집중되어 있던 UI 렌더링 및 상태 관리 로직을 관심사에 따라 분리하여 코드의 가독성, 재사용성, 유지보수성을 향상함.
- **작업 상세:**
  - **`types.ts` 생성:**
    - `frontend/src/types.ts` 파일을 생성하고, `FileItem` 인터페이스를 이 파일로 이동시켜 타입 정의를 중앙에서 관리하도록 변경함.
  - **컴포넌트 분리:**
    - `frontend/src/components` 디렉터리를 생성함.
    - `App.tsx`의 각 UI 부분을 다음과 같은 독립적인 컴포넌트 파일로 분리함:
      - `Header.tsx`: 로고와 애플리케이션 제목을 표시하는 정적 컴포넌트.
      - `PathNavigator.tsx`: 현재 경로를 표시하고 '뒤로 가기' 버튼을 관리하는 컴포넌트.
      - `FileItem.tsx`: 개별 파일 또는 디렉터리 아이템 한 줄을 렌더링하는 컴포넌트.
      - `FileList.tsx`: `FileItem` 컴포넌트들을 목록 형태로 렌더링하는 컴포넌트.
  - **`App.tsx` 리팩토링:**
    - `App.tsx`를 상태 관리(State)와 비즈니스 로직(Handler, Effect)에만 집중하는 **컨테이너(Container) 컴포넌트**로 변경함.
    - UI 렌더링은 새로 생성된 **프레젠테이셔널(Presentational) 컴포넌트**들(`Header`, `PathNavigator`, `FileList`)을 조합하여 수행하도록 수정함.
    - 상태와 이벤트 핸들러를 `props`를 통해 자식 컴포넌트로 전달하는 구조로 변경함.

### 3. 프론트엔드 UI/UX 개선
- **기본적인 스타일링 추가:**
  - `App.css`를 수정하여 `App-header`의 레이아웃을 조정하고, 파일 목록(`ul`, `li`) 및 버튼에 기본적인 스타일을 추가하여 파일 탐색기 UI에 더 적합하도록 시각적 개선을 진행함.
  - `Header.tsx`, `PathNavigator.tsx`, `FileItem.tsx` 컴포넌트의 JSX에 CSS 클래스를 적용하여 스타일링을 연동함.
- **로딩 및 에러 상태에 대한 시각적 피드백 강화:**
  - `App.tsx`에 `isLoading` 상태를 추가하고, 파일 데이터를 가져오는 동안 "Loading files..." 메시지를 표시하도록 구현함.
- **파일/디렉터리 아이콘 개선:**
  - `FileItem.tsx`에 파일 확장자에 따라 다른 이모지 아이콘을 반환하는 `getFileIcon` 헬퍼 함수를 추가하고, 이를 사용하여 아이콘을 렌더링하도록 JSX를 수정함. (예: 이미지 파일 🖼️, 비디오 파일 🎬, 코드 파일 💻 등)

### 4. 백엔드 파일 시스템 Provider 패턴 구현 및 Synology API 연동
- **확장 가능한 Provider 패턴 도입:**
  - `backend/providers` 디렉터리를 생성하고, 모든 파일 시스템 Provider가 따라야 할 `FileSystemProvider` 추상 클래스(`base.py`)를 정의함.
  - `FileItem` Pydantic 모델을 정의하여 프론트엔드와 백엔드 간 데이터 형식을 통일함.
- **`LocalProvider` 구현:**
  - 기존 `main.py`의 로컬 파일 시스템 접근 로직을 `LocalProvider`(`local.py`)로 분리하여 `FileSystemProvider` 인터페이스를 구현함.
  - `list_files` 메서드를 비동기(`async def`)로 통일하여 추상화의 일관성을 확보함.
- **`SynologyAPIProvider` 구현 및 로그인 페이지 연동:**
  - `SynologyAPIProvider`(`synology.py`)를 구현하여 Synology NAS 로그인 및 파일 목록 조회 로직을 포함함.
  - `httpx` 라이브러리를 `requirements.txt`에 추가하여 비동기 HTTP 요청을 지원함.
  - 환경 변수 방식 대신, 사용자로부터 직접 접속 정보를 입력받는 **로그인 페이지 방식**으로 전환함.
  - `main.py`를 수정하여 `lifespan` 관리자를 제거하고, 세션 기반 인증 시스템을 도입함.
  - `/api/login` 엔드포인트를 추가하여 Synology 접속 정보를 받아 세션을 생성하고, `Authorization` 헤더의 토큰으로 사용자별 Provider를 조회하도록 변경함.
  - `Login.tsx` 컴포넌트와 `Login.css`를 새로 생성하여 로그인 폼 UI를 구현하고, `App.tsx`에서 로그인 상태에 따라 조건부 렌더링하도록 수정함.

### 5. Synology API 연동 과정 중 발생한 오류 해결 및 디버깅

Synology NAS와의 연동 과정에서 발생한 다양한 오류들을 해결하며 시스템의 안정성과 사용자 경험을 개선함.

-   **`Error: [SSL: WRONG_VERSION_NUMBER]` (HTTPS/HTTP 프로토콜 불일치):**
    -   **원인:** 프론트엔드에서 `secure` 플래그를 보내지 않아 백엔드가 기본값인 HTTPS로 연결을 시도했으나, NAS가 HTTP로 응답하여 발생.
    -   **해결:** `Login.tsx`에 "Use HTTPS (SSL)" 체크박스를 추가하고, `secure` 상태에 따라 포트 기본값을 동적으로 변경하며, 이 값을 백엔드로 전달하도록 수정.

-   **`Error: Synology 로그인 실패. 오류 코드: 403` (2단계 인증 필요):**
    -   **원인:** Synology 계정에 2단계 인증(2FA)이 활성화되어 있었으나, 로그인 요청에 OTP 코드가 누락되어 발생.
    -   **해결:** `LoginRequest` 모델(`main.py`)과 `_login` 메서드(`synology.py`)에 `otp_code` 필드를 추가하고, `Login.tsx`에 OTP 입력 필드를 추가하여 2FA를 지원하도록 수정.

-   **`Error: request: Field required` (FastAPI Pydantic 유효성 검사 오류):**
    -   **원인:** `main.py`의 `/api/login` 엔드포인트 파라미터 이름(`request`)이 FastAPI 내부 `Request` 객체와 충돌하여 발생한 것으로 추정.
    -   **해결:** `/api/login` 엔드포인트의 파라미터 이름을 `login_data`로 변경하고, `get_provider` 의존성 주입 함수의 `request: object` 시그니처를 `req: Request`로 표준화하여 이름 충돌 가능성을 제거. `App.tsx`의 에러 처리 로직을 개선하여 Pydantic 유효성 검사 오류 발생 시 어떤 필드가 문제인지 상세히 표시하도록 수정.

-   **`Error: 파일 목록 조회 실패. 오류 코드: 401` (유효하지 않은 세션 ID):**
    -   **원인:** 로그인 성공 후 파일 목록 조회 시, `_sid` 또는 `Syno-Token`이 Synology API에 올바르게 전달되지 않아 발생.
    -   **해결:** `synology.py`의 `_login` 메서드에서 `synotoken`을 `httpx` 클라이언트의 `X-SYNO-Token` 헤더로 설정하고, `list_files` 메서드에서 `_sid`를 URL 파라미터에 명시적으로 다시 포함시켜 모든 인증 정보를 함께 전달하도록 수정. `list_files` 내부의 복잡한 재로그인 로직을 제거하여 오류 발생 시 명확한 `PermissionError`를 반환하도록 단순화.

-   **`GET /api/files?path=%2F HTTP/1.1" 403 Forbidden` (루트 경로 접근 권한 문제):**
    -   **원인:** Synology API가 `/`와 같은 최상위 루트 경로에 대한 직접적인 파일 목록 조회를 허용하지 않고, 공유 폴더 목록 조회를 요구하여 발생.
    -   **해결:** `synology.py`에 `list_shares` 메서드를 추가하여 Synology API의 `list_share` 기능을 구현함. `main.py`의 `/api/files` 엔드포인트에서 요청된 `path`가 `/` 또는 `.`일 경우, `SynologyAPIProvider`에 대해 `list_shares()`를 호출하여 공유 폴더 목록을 반환하도록 로직을 추가.

## 다음 계획
-   **파일/폴더 관리 기능 확장:** 파일 업로드, 다운로드, 이름 변경, 삭제, 이동 등 기본적인 파일 시스템 작업 구현.
-   **AI 기능 통합:** 스마트 검색, 자동 태그 지정, 비디오 콘텐츠 분석 등 AI 기반 기능 개발.
-   **UI/UX 개선:** 사용자 친화적인 인터페이스 및 경험을 위한 추가적인 프론트엔드 개선.
-   **설정 관리:** Synology NAS 연결 정보 등을 저장하고 관리하는 기능 구현 (예: 설정 파일, 데이터베이스).
